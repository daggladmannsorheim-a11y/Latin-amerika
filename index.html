<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake: Sør-Amerika – Flagg & Land (kontrast + vegger AV)</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
    --accent:#22c55e; --danger:#ef4444; --edge:#1f2937;
    --contrast:#0b1327; /* ny kontrastbakgrunn for quiz */
    --choice:#111827;   /* høy-kontrast bak valgknapper */
    --choice-border:#475569;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,Segoe UI,Roboto,Inter,Ubuntu,'Noto Sans',sans-serif;
    background:#0b1020; color:var(--text);
    display:flex; min-height:100vh; align-items:center; justify-content:center; padding:16px;
  }
  .wrap{display:grid; gap:14px; grid-template-columns: 1fr 360px; max-width:1200px; width:100%;}
  canvas#game{background:#020617; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.4), inset 0 0 0 1px var(--edge)}
  .panel{background:#0e162b; border:1px solid var(--edge); border-radius:14px; padding:14px}
  .panel h2{margin:0 0 8px 0; font-size:18px}
  .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .badge{padding:6px 10px; border-radius:999px; background:#0b1327; border:1px solid var(--edge); font-variant-numeric:tabular-nums}
  .btn{appearance:none; border:1px solid #334155; background:#0b1327; color:var(--text); padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:600}
  .btn.primary{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#166534}
  .btn.warn{background:linear-gradient(180deg,#ef4444,#b91c1c); border-color:#7f1d1d}
  .small{font-size:12px; color:var(--muted)}
  .keys{display:grid; grid-template-columns:repeat(3,60px); gap:6px; justify-content:center; margin-top:10px}
  .key{height:48px; display:flex; align-items:center; justify-content:center; background:#0b1327; border:1px solid var(--edge); border-radius:10px; color:var(--text); cursor:pointer}
  .keys-wasd{display:grid; grid-template-columns:repeat(3,60px); gap:6px; justify-content:center; margin-top:6px}

  /* Quiz modal – økt kontrast */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:10}
  .modal.open{display:flex}
  .card{width:min(560px, calc(100vw - 32px)); background:#0e162b; border:1px solid var(--edge); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.5)}
  .qbox{background:var(--contrast); border:1px solid var(--edge); border-radius:12px; padding:10px}
  .choices{display:grid; gap:10px; margin-top:12px}
  .choice{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background:var(--choice); border:1px solid var(--choice-border);
    border-radius:12px; padding:12px; cursor:pointer
  }
  .choice:hover{filter:brightness(1.08)}
  .choice.correct{outline:2px solid var(--accent)}
  .choice.wrong{outline:2px solid var(--danger)}

  .gameover{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:11; background:rgba(2,6,23,.7)}
  .gameover.open{display:flex}
  .overcard{background:#020617; border:1px solid var(--edge); border-radius:16px; padding:18px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,.5)}

  .lists{display:grid; gap:10px; margin-top:10px}
  .listbox{background:#0b1327; border:1px solid var(--edge); border-radius:12px; padding:10px}
  .listbox h3{margin:0 0 6px 0; font-size:14px}
  .tags{display:flex; flex-wrap:wrap; gap:6px}
  .tag{padding:6px 8px; border-radius:999px; background:#0f1b35; border:1px solid #263248; font-size:12px}
  .scores{display:grid; gap:6px; margin-top:6px}
  .scorerow{display:flex; gap:8px; justify-content:space-between; font-variant-numeric:tabular-nums; padding:6px 8px; border-radius:8px; background:#0b1327; border:1px solid #273149}

  @media (max-width: 1080px){ .wrap{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Litt mindre spillområde -->
    <canvas id="game" width="560" height="560" aria-label="Spillbrett"></canvas>

    <aside class="panel">
      <h2>Snake – Sør-Amerika</h2>
      <div class="row" style="margin-bottom:10px">
        <span class="badge">Poeng: <span id="score">0</span></span>
        <span class="badge">Lengde: <span id="length">3</span></span>
        <span class="badge">Hastighet: <span id="speedDisp">7</span> tps</span>
        <span class="badge">Beste: <span id="bestScore">0</span></span>
      </div>

      <div class="row" style="gap:8px; margin-bottom:8px">
        <button class="btn primary" id="startBtn">Start / Pause (Space)</button>
        <button class="btn" id="resetBtn">Restart (R)</button>
        <button class="btn warn" id="wallBtn">Vegger: <span id="wallMode">AV</span></button>
      </div>

      <div class="small">Styr med piltaster/WASD – eller bruk knappene under.</div>

      <div class="panel" style="padding:12px; margin-top:10px">
        <div class="small" style="margin-bottom:8px">Piltaster</div>
        <div class="keys">
          <div></div><button class="key" data-dir="up">↑</button><div></div>
          <button class="key" data-dir="left">←</button>
          <button class="key" data-dir="down">↓</button>
          <button class="key" data-dir="right">→</button>
        </div>
        <div class="small" style="margin:12px 0 8px">WASD</div>
        <div class="keys-wasd">
          <div></div><button class="key" data-dir="w">W</button><div></div>
          <button class="key" data-dir="a">A</button>
          <button class="key" data-dir="s">S</button>
          <button class="key" data-dir="d">D</button>
        </div>
      </div>

      <div class="lists">
        <div class="listbox">
          <h3>Rekorder</h3>
          <div id="scores" class="scores"></div>
        </div>
        <div class="listbox">
          <h3>Flagg jeg kan (sist riktig)</h3>
          <div id="known" class="tags"></div>
        </div>
        <div class="listbox">
          <h3>Flagg jeg må øve på (sist feil/ikke sett)</h3>
          <div id="unknown" class="tags"></div>
        </div>
      </div>

      <div class="small" style="margin-top:8px">
        Beste/rekorder og læringslister lagres lokalt i nettleseren.
      </div>
    </aside>
  </div>

  <!-- Quiz Modal (med kontrastbakgrunn) -->
  <div class="modal" id="quizModal" role="dialog" aria-modal="true" aria-labelledby="qTitle">
    <div class="card">
      <div class="qbox">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
          <div id="qTitle" class="small" style="background:#0a1833; padding:8px 10px; border-radius:10px; border:1px solid #38507a; color:#eaf2ff">
            Hvilket land hører dette flagget til?
          </div>
          <div class="small" style="background:#0a1833; padding:8px 10px; border-radius:10px; border:1px solid #38507a; color:#eaf2ff">
            Runde: <span id="roundNum">1</span>
          </div>
        </div>
        <div style="display:flex; align-items:center; gap:14px; margin-top:12px">
          <canvas id="qFlagCanvas" width="160" height="96" style="border-radius:8px; background:#0a1833; border:1px solid #38507a"></canvas>
          <div class="small" id="qHint" style="color:#e8eefc"></div>
        </div>
        <div class="choices" id="choices" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  <!-- Game Over overlay -->
  <div class="gameover" id="over" aria-hidden="true">
    <div class="overcard">
      <h3 style="margin:0 0 8px 0">Game Over</h3>
      <div class="small" style="margin-bottom:10px">Trykk <b>R</b> eller klikk Restart</div>
      <div class="row" style="justify-content:center">
        <button class="btn" id="restartBtn">Restart</button>
      </div>
    </div>
  </div>

<script>
/* ========= Data ========= */
const COUNTRIES = [
  {name:"Argentina", capital:"Buenos Aires"},
  {name:"Bolivia", capital:"Sucre/La Paz"},
  {name:"Brasil", capital:"Brasília"},
  {name:"Chile", capital:"Santiago"},
  {name:"Colombia", capital:"Bogotá"},
  {name:"Ecuador", capital:"Quito"},
  {name:"Guyana", capital:"Georgetown"},
  {name:"Paraguay", capital:"Asunción"},
  {name:"Peru", capital:"Lima"},
  {name:"Surinam", capital:"Paramaribo"},
  {name:"Uruguay", capital:"Montevideo"},
  {name:"Venezuela", capital:"Caracas"},
];

/* ========= Utils ========= */
const rand = (min, max) => Math.floor(Math.random()*(max-min+1))+min;
const choice = (arr) => arr[rand(0, arr.length-1)];
const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]);

/* ========= Canvas & State ========= */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const SIZE = 20;
const COLS = Math.floor(canvas.width / SIZE);
const ROWS = Math.floor(canvas.height / SIZE);

const scoreEl = document.getElementById('score');
const lengthEl = document.getElementById('length');
const speedDisp = document.getElementById('speedDisp');
const bestScoreEl = document.getElementById('bestScore');
const wallBtn = document.getElementById('wallBtn');
const wallMode = document.getElementById('wallMode');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const restartBtn = document.getElementById('restartBtn');
const over = document.getElementById('over');

const quizModal = document.getElementById('quizModal');
const qFlagCanvas = document.getElementById('qFlagCanvas');
const qCtx = qFlagCanvas.getContext('2d');
const qHint = document.getElementById('qHint');
const choicesWrap = document.getElementById('choices');
const roundNum = document.getElementById('roundNum');

const scoresEl = document.getElementById('scores');
const knownEl = document.getElementById('known');
const unknownEl = document.getElementById('unknown');

/* ========= Persistence ========= */
let best = +localStorage.getItem('sa_snake_best') || 0;
let scoreHistory = [];
try{ scoreHistory = JSON.parse(localStorage.getItem('sa_snake_scores')||'[]'); }catch{ scoreHistory = []; }

// stats per land
let stats = {};
try{ stats = JSON.parse(localStorage.getItem('sa_snake_stats')||'{}'); }catch{ stats = {}; }
COUNTRIES.forEach(c=>{ if(!stats[c.name]) stats[c.name] = {correct:0, wrong:0, last:''}; });

/* ========= Game state ========= */
let speed, snake, dir, nextDir, food, running, paused, pausedForQuiz, score, growth, wallsOn, round;
let rafId = null;
let lastTime = 0, tickAccum = 0;
let pendingCountry = null;

/* ========= Forhindre side-scroll ved piltaster ========= */
window.addEventListener('keydown', (e)=>{
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)){
    e.preventDefault();
  }
}, {passive:false});

/* ========= Flaggtegning ========= */
function drawFlag(g, x, y, w, h, cName){
  g.save();
  const rect = (cx,cy,cw,ch,color)=>{ g.fillStyle=color; g.fillRect(cx,cy,cw,ch); };
  const stripeH = h/3, stripeV = w/3;
  g.lineWidth = 1; g.strokeStyle = "#0006";
  switch(cName){
    case "Argentina":
      rect(x,y,w,h,"#75AADB"); rect(x,y+stripeH,w,stripeH,"#FFFFFF"); break;
    case "Bolivia":
      rect(x,y,w,stripeH,"#D52B1E"); rect(x,y+stripeH,w,stripeH,"#FCD116"); rect(x,y+2*stripeH,w,stripeH,"#007934"); break;
    case "Brasil":
      rect(x,y,w,h,"#009B3A");
      g.fillStyle="#FFDF00"; g.beginPath(); g.moveTo(x+w*0.5, y+h*0.08); g.lineTo(x+w*0.92, y+h*0.5);
      g.lineTo(x+w*0.5, y+h*0.92); g.lineTo(x+w*0.08, y+h*0.5); g.closePath(); g.fill();
      g.beginPath(); g.fillStyle="#002776"; g.arc(x+w*0.5, y+h*0.5, Math.min(w,h)*0.22, 0, Math.PI*2); g.fill();
      break;
    case "Chile":
      rect(x,y,w,h,"#D52B1E"); rect(x,y,w,h/2,"#FFFFFF"); rect(x,y,w*0.35,h/2,"#0039A6");
      g.fillStyle="#FFFFFF"; g.beginPath(); g.arc(x+w*0.175, y+h*0.25, Math.min(w,h)*0.04, 0, Math.PI*2); g.fill();
      break;
    case "Colombia":
    case "Ecuador":
      rect(x,y,w,h*0.5,"#FCD116"); rect(x,y+h*0.5,w,h*0.25,"#003893"); rect(x,y+h*0.75,w,h*0.25,"#CE1126"); break;
    case "Guyana":
      rect(x,y,w,h,"#009E49");
      g.fillStyle="#FCD116"; g.beginPath(); g.moveTo(x, y); g.lineTo(x+w*0.85, y+h*0.5); g.lineTo(x, y+h); g.closePath(); g.fill();
      g.fillStyle="#CE1126"; g.beginPath(); g.moveTo(x, y+h*0.06); g.lineTo(x+w*0.78, y+h*0.5); g.lineTo(x, y+h*0.94); g.closePath(); g.fill();
      g.strokeStyle="#FFFFFF"; g.lineWidth = Math.max(1, w*0.02); g.beginPath(); g.moveTo(x, y); g.lineTo(x+w*0.85, y+h*0.5); g.lineTo(x, y+h); g.stroke();
      break;
    case "Paraguay":
      rect(x,y,w,stripeH,"#D52B1E"); rect(x,y+stripeH,w,stripeH,"#FFFFFF"); rect(x,y+2*stripeH,w,stripeH,"#0038A8"); break;
    case "Peru":
      rect(x,y, stripeV, h,"#D91023"); rect(x+stripeV,y, stripeV, h,"#FFFFFF"); rect(x+2*stripeV,y, stripeV, h,"#D91023"); break;
    case "Surinam":
      rect(x,y,w,h,"#377E3F"); rect(x,y+h*0.2,w,h*0.6,"#FFFFFF"); rect(x,y+h*0.3,w,h*0.4,"#B40A2D");
      drawStar(g, x+w*0.5, y+h*0.5, Math.min(w,h)*0.12, Math.min(w,h)*0.05, 5, "#FCD116"); break;
    case "Uruguay":
      rect(x,y,w,h,"#FFFFFF"); g.fillStyle="#3A75C4";
      const stripes=9; for(let i=1;i<stripes;i+=2){ rect(x, y+(h/stripes)*i, w, h/stripes, "#3A75C4"); }
      g.fillStyle="#FCD116"; g.beginPath(); g.arc(x+w*0.17, y+h*0.23, Math.min(w,h)*0.10, 0, Math.PI*2); g.fill(); break;
    case "Venezuela":
      rect(x,y,w,h/3,"#FCD116"); rect(x,y+h/3,w,h/3,"#003893"); rect(x,y+2*h/3,w,h/3,"#CE1126");
      g.fillStyle="#FFFFFF"; const cx=x+w*0.5, cy=y+h*0.5, r=Math.min(w,h)*0.22, stars=7;
      for(let i=0;i<stars;i++){ const a=Math.PI*(1 + (i - (stars-1)/2)*0.1); g.beginPath(); g.arc(cx + r*Math.cos(a), cy + r*0.7*Math.sin(a), Math.min(w,h)*0.02, 0, Math.PI*2); g.fill(); }
      break;
  }
  g.strokeStyle="#0006"; g.strokeRect(x, y, w, h);
  g.restore();
}
function drawStar(g, cx, cy, outerR, innerR, points, color){
  g.save(); g.fillStyle=color; g.beginPath();
  let angle=-Math.PI/2, step=Math.PI/points;
  for(let i=0;i<points*2;i++){ const r=(i%2===0)? outerR : innerR; g.lineTo(cx+Math.cos(angle)*r, cy+Math.sin(angle)*r); angle+=step; }
  g.closePath(); g.fill(); g.restore();
}

/* ========= Safe start/reset ========= */
function newGame(){
  cancelAnim();
  speed = 7; // roligere start
  snake = [];
  const cx = Math.floor(COLS/2), cy = Math.floor(ROWS/2);
  snake.push({x:cx, y:cy}, {x:cx-1, y:cy}, {x:cx-2, y:cy});
  dir = {x:1,y:0}; nextDir = {x:1,y:0};
  growth = 0; score = 0; round = 1;
  paused = false; pausedForQuiz = false; running = true;
  // Vegger AV som default
  wallsOn = false;
  pendingCountry = null;
  hideOver();
  placeFood();
  updateHUD();
  lastTime = performance.now(); tickAccum = 0;
  rafId = requestAnimationFrame(loop);
}
function updateHUD(){
  scoreEl.textContent = score;
  lengthEl.textContent = snake.length;
  speedDisp.textContent = speed;
  bestScoreEl.textContent = best;
  wallMode.textContent = wallsOn ? "PÅ" : "AV";
  renderScores();
  renderLists();
}

/* ========= Food ========= */
function randomEmptyCell(){
  while(true){
    const cell = {x: rand(0,COLS-1), y: rand(0,ROWS-1)};
    if(!snake.some(s=>s.x===cell.x && s.y===cell.y)) return cell;
  }
}
function placeFood(){
  const cell = randomEmptyCell();
  const country = pendingCountry ? pendingCountry : choice(COUNTRIES);
  food = { ...cell, country };
  pendingCountry = null;
}

/* ========= Input ========= */
const KEYS = {
  ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0},
  w:{x:0,y:-1}, a:{x:-1,y:0}, s:{x:0,y:1}, d:{x:1,y:0},
};
addEventListener('keydown', (e)=>{
  if(e.key === ' '){ e.preventDefault(); togglePause(); return; }
  if(e.key === 'r' || e.key === 'R'){ e.preventDefault(); newGame(); return; }
  const v = KEYS[e.key];
  if(!v || !running || paused || pausedForQuiz) return;
  if(snake.length>1 && (v.x === -dir.x && v.y === -dir.y)) return;
  nextDir = v;
});
document.querySelectorAll('.key').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const d = btn.dataset.dir;
    const map = {up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}, w:{x:0,y:-1}, a:{x:-1,y:0}, s:{x:0,y:1}, d:{x:1,y:0}};
    const v = map[d];
    if(!v || !running || paused || pausedForQuiz) return;
    if(snake.length>1 && (v.x === -dir.x && v.y === -dir.y)) return;
    nextDir = v;
  });
});
startBtn.onclick = ()=>togglePause();
resetBtn.onclick = ()=>newGame();
restartBtn.onclick = ()=>newGame();
wallBtn.onclick = ()=>{ wallsOn = !wallsOn; updateHUD(); };

function togglePause(){
  if(!running || pausedForQuiz) return;
  paused = !paused;
  if(!paused){ lastTime = performance.now(); rafId = requestAnimationFrame(loop); }
  else { cancelAnim(); }
}

function gameOver(){
  running = false; paused = false; pausedForQuiz = false;
  cancelAnim();
  over.classList.add('open');
  over.setAttribute('aria-hidden','false');
  // lagre rekorder
  best = Math.max(best, score);
  localStorage.setItem('sa_snake_best', String(best));
  const entry = {score, date:new Date().toISOString()};
  scoreHistory.push(entry);
  scoreHistory.sort((a,b)=>b.score-a.score);
  scoreHistory = scoreHistory.slice(0,10);
  localStorage.setItem('sa_snake_scores', JSON.stringify(scoreHistory));
  updateHUD();
}
function hideOver(){
  over.classList.remove('open');
  over.setAttribute('aria-hidden','true');
}
function cancelAnim(){
  if(rafId !== null){ cancelAnimationFrame(rafId); rafId = null; }
}

/* ========= Loop ========= */
function loop(ts){
  if(!running || paused) return;
  const dt = (ts - lastTime)/1000; lastTime = ts;
  tickAccum += dt * speed;
  while(tickAccum >= 1){ step(); tickAccum -= 1; }
  draw();
  rafId = requestAnimationFrame(loop);
}
function step(){
  if(pausedForQuiz) return;
  const prev = dir; dir = nextDir;
  if(snake.length>1 && (dir.x === -prev.x && dir.y === -prev.y)) dir = prev;

  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

  if(wallsOn){
    if(head.x<0 || head.x>=COLS || head.y<0 || head.y>=ROWS) return gameOver();
  } else {
    if(head.x<0) head.x = COLS-1;
    if(head.x>=COLS) head.x = 0;
    if(head.y<0) head.y = ROWS-1;
    if(head.y>=ROWS) head.y = 0;
  }
  if(snake.some(seg=>seg.x===head.x && seg.y===head.y)) return gameOver();

  snake.unshift(head);

  if(head.x === food.x && head.y === food.y){
    pausedForQuiz = true;
    openQuiz(food.country);
  } else {
    if(growth>0){ growth--; } else { snake.pop(); }
  }

  // myk progresjon
  if(score>0 && score % 6 === 0){ speed = Math.min(15, 7 + Math.floor(score/6)); }
  updateHUD();
}

/* ========= Draw ========= */
function drawGrid(){
  ctx.save();
  ctx.strokeStyle = '#0b1224';
  for(let x=0; x<=COLS; x++){ ctx.beginPath(); ctx.moveTo(x*SIZE,0); ctx.lineTo(x*SIZE, canvas.height); ctx.stroke(); }
  for(let y=0; y<=ROWS; y++){ ctx.beginPath(); ctx.moveTo(0,y*SIZE); ctx.lineTo(canvas.width, y*SIZE); ctx.stroke(); }
  ctx.restore();
}
function drawFood(){
  if(!food) return;
  const pad = 2;
  const x = food.x*SIZE + pad, y = food.y*SIZE + pad;
  const w = SIZE - pad*2, h = SIZE - pad*2;
  drawFlag(ctx, x, y, w, h, food.country.name);
}
function drawSnake(){
  for(let i=0;i<snake.length;i++){
    const s = snake[i];
    const x = s.x*SIZE, y = s.y*SIZE;
    const isHead = (i===0);
    ctx.fillStyle = isHead ? '#22c55e' : '#16a34a';
    ctx.fillRect(x+2,y+2,SIZE-4,SIZE-4);
    ctx.fillStyle = 'rgba(255,255,255,.08)';
    ctx.fillRect(x+3,y+3,SIZE-6,SIZE-8);
    if(isHead){
      ctx.fillStyle = '#052e16';
      ctx.beginPath(); ctx.arc(x+SIZE*0.7, y+SIZE*0.35, 3, 0, Math.PI*2); ctx.fill();
    }
  }
}
function draw(){
  ctx.fillStyle = '#030712'; ctx.fillRect(0,0,canvas.width,canvas.height);
  drawGrid();
  drawFood();
  drawSnake();
}

/* ========= Quiz & læring ========= */
function openQuiz(country){
  roundNum.textContent = round++;
  qCtx.clearRect(0,0,qFlagCanvas.width,qFlagCanvas.height);
  drawFlag(qCtx, 8, 8, qFlagCanvas.width-16, qFlagCanvas.height-16, country.name);

  qHint.innerHTML = `<b>Hint:</b> hovedstad: ${country.capital}`;
  const opts = shuffle([country, ...shuffle(COUNTRIES.filter(c=>c.name!==country.name)).slice(0,3)]);
  choicesWrap.innerHTML = '';
  opts.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'choice';
    btn.innerHTML = `<span>${opt.name}</span> <span class="small">Flaggquiz</span>`;
    btn.onclick = ()=>evaluateChoice(btn, opt.name === country.name, country);
    choicesWrap.appendChild(btn);
  });
  quizModal.classList.add('open');
}
function evaluateChoice(btn, ok, country){
  const all = [...choicesWrap.querySelectorAll('.choice')];
  all.forEach(b=>b.disabled = true);

  if(ok){
    btn.classList.add('correct');
    stats[country.name].correct += 1;
    stats[country.name].last = 'correct';
    localStorage.setItem('sa_snake_stats', JSON.stringify(stats));
    score += 1; growth += 1;
  } else {
    btn.classList.add('wrong');
    stats[country.name].wrong += 1;
    stats[country.name].last = 'wrong';
    localStorage.setItem('sa_snake_stats', JSON.stringify(stats));
    const right = all.find(b=>b.textContent.trim().startsWith(country.name));
    if(right) right.classList.add('correct');
    pendingCountry = country; // samme flagg neste gang
  }

  setTimeout(()=>{
    quizModal.classList.remove('open');
    placeFood();
    pausedForQuiz = false;
    updateHUD();
  }, ok ? 350 : 650);
}

/* ========= Rekorder & lister ========= */
function renderScores(){
  scoresEl.innerHTML = '';
  if(scoreHistory.length === 0){
    const row = document.createElement('div');
    row.className = 'small';
    row.textContent = 'Ingen rekorder enda.';
    scoresEl.appendChild(row);
    return;
  }
  scoreHistory.forEach((s,i)=>{
    const row = document.createElement('div');
    row.className = 'scorerow';
    const date = new Date(s.date);
    row.innerHTML = `<span>#${i+1}</span><span>${s.score} poeng</span><span class="small">${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>`;
    scoresEl.appendChild(row);
  });
}
function renderLists(){
  knownEl.innerHTML = '';
  unknownEl.innerHTML = '';
  const known = [], unknown = [];
  COUNTRIES.forEach(c=>{
    const st = stats[c.name];
    if(st.last === 'correct') known.push(c);
    else unknown.push(c);
  });
  const makeTag = (c) => {
    const t = document.createElement('span');
    const st = stats[c.name];
    t.className = 'tag';
    t.textContent = `${c.name} (${st.correct}✓/${st.wrong}✗)`;
    return t;
  };
  known.forEach(c=>knownEl.appendChild(makeTag(c)));
  unknown.forEach(c=>unknownEl.appendChild(makeTag(c)));
}

/* ========= Kickoff ========= */
renderScores();
renderLists();
newGame();
</script>
</body>
</html>
